-----------------------------------------------------------------------
drop extension if exists flow cascade;
NOTICE:  extension "flow" does not exist, skipping
create extension flow;
select '[]'::flow;
 flow 
------
 []
(1 row)

-- id,nr,qtt_prov,qtt_requ,own,qtt,np
select '[(1,2,3,4,5,6,7)]'::flow as flow;
          flow           
-------------------------
 [(1, 2, 3, 4, 5, 6, 7)]
(1 row)

select '[(1,2,3,4,5,6,7),(9,7,11,12,13,14,15)]'::flow as flow;
                        flow                        
----------------------------------------------------
 [(1, 2, 3, 4, 5, 6, 7),(9, 7, 11, 12, 13, 14, 15)]
(1 row)

-- it's not a loop; expected: 0
select flow_refused('[(1,2,3,4,5,6,7),(9,7,11,12,13,14,15)]'::flow);
 flow_refused 
--------------
            0
(1 row)

-- agreement without barter ;expected: -1
select flow_refused('[(100,2,20,30,110,20,1),(101,1,30,20,111,30,2)]'::flow);
 flow_refused 
--------------
           -1
(1 row)

-- agreement with long barter ;expected: -1
select flow_refused('[(100,2,20,30,110,20,1),(101,1,30,10,111,30,2)]'::flow);
 flow_refused 
--------------
           -1
(1 row)

-- agreement with short barter ;expected: != -1
select flow_refused('[(100,2,20,30,110,20,1),(101,1,30,25,111,30,2)]'::flow);
 flow_refused 
--------------
            1
(1 row)

--select flow_status('[(1,2,3,4,5,6,7)]'::flow);
--select flow_omega('[(1,2,3,4,5,6,7,8)]'::flow);
select flow_omegay('[(1,2,3,4,5,6,7)]'::flow,'[(1,2,3,4,5,6,7)]'::flow,2,1);
 flow_omegay 
-------------
 t
(1 row)

select flow_cat('[(1,2,3,4,5,6,7)]'::flow,9,7,11,12,13,14,15);
                      flow_cat                      
----------------------------------------------------
 [(1, 2, 3, 4, 5, 6, 7),(9, 7, 11, 12, 13, 14, 15)]
(1 row)

select flow_proj('[(1,2,3,4,5,6,7),(8,7,10,11,12,13,14)]'::flow,1);
 flow_proj 
-----------
 {1,8}
(1 row)

select flow_proj('[(1,2,3,4,5,6,7),(8,7,10,11,12,13,14)]'::flow,2);
 flow_proj 
-----------
 {2,7}
(1 row)

select flow_proj('[(1,2,3,4,5,6,7),(8,7,10,11,12,13,14)]'::flow,8);
 flow_proj 
-----------
 {0,0}
(1 row)

select flow_dim('[(1,2,3,4,5,6,7),(8,7,10,11,12,13,14)]'::flow);
 flow_dim 
----------
        2
(1 row)

select flow_to_matrix('[(1,2,3,4,5,6,7),(8,7,10,11,12,13,14)]'::flow);
               flow_to_matrix               
--------------------------------------------
 {{1,2,3,4,5,6,7,0},{8,7,10,11,12,13,14,0}}
(1 row)

-- cycle 3 nodes, 3 stocks
-- id,nr,qtt_prov,qtt_requ,own,qtt,np
-- result {20,80,40}
select flow_proj('[(1,3,1,1,1,20,1),(2,1,8,1,2,80,2),(3,2,1,1,3,120,3)]'::flow,8);
 flow_proj  
------------
 {20,80,40}
(1 row)

-- cycle 3 nodes, 3 stocks - all stock exhausted
-- id,nr,qtt_prov,qtt_requ,,own,qtt,np
-- result {20,80,40}
select flow_proj('[(1,3,1,1,1,20,1),(2,1,8,1,2,80,2),(3,2,1,1,3,40,3)]'::flow,8);
 flow_proj  
------------
 {20,80,40}
(1 row)

-- cycle 2 nodes, 2 stocks,2 owners
-- id,nr,qtt_prov,qtt_requ,sid,own,qtt,np
-- result {20,20}
select flow_proj('[(1,2,2,1,1,20,1),(2,1,2,1,2,120,2)]'::flow,8);
 flow_proj 
-----------
 {20,20}
(1 row)

-- flow 8 nodes, 8 stocks, 8 owners
select flow_proj('[
(1,8,1,1,1, 10,1),
(2,1,1,1,2, 100,2),
(3,2,1,1,3, 100,3),
(4,3,1,1,4, 100,4),
(5,4,1,1,5, 100,5),
(6,5,1,1,6, 100,6),
(7,6,1,1,7, 100,7),
(8,7,1,1,8, 100,8)]'::flow,8);
         flow_proj         
---------------------------
 {10,10,10,10,10,10,10,10}
(1 row)

/* flow 9 nodes produces an error */
select flow_proj('[
(1,9,1,1,1, 10,1),
(2,1,1,1,2, 10,2),
(3,2,1,1,3, 10,3),
(4,3,1,1,4, 10,4),
(5,4,1,1,5, 10,5),
(6,5,1,1,6, 10,6),
(7,6,1,1,7, 10,7),
(8,7,1,1,8, 10,8),
(9,8,1,1,9, 10,9)]'::flow,8); 
ERROR:  bad flow representation
LINE 2: select flow_proj('[
                         ^
DETAIL:  A flow cannot have more than 8 orders.
