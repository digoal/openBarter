select ftruncatetables();
NOTICE:  truncate cascades to table "torder"
CONTEXT:  SQL statement "TRUNCATE tquality CASCADE"
PL/pgSQL function "ftruncatetables" line 11 at SQL statement
NOTICE:  truncate cascades to table "tmvt"
CONTEXT:  SQL statement "TRUNCATE tquality CASCADE"
PL/pgSQL function "ftruncatetables" line 11 at SQL statement
NOTICE:  truncate cascades to table "tmvtremoved"
CONTEXT:  SQL statement "TRUNCATE tquality CASCADE"
PL/pgSQL function "ftruncatetables" line 11 at SQL statement
NOTICE:  truncate cascades to table "torder"
CONTEXT:  SQL statement "TRUNCATE towner CASCADE"
PL/pgSQL function "ftruncatetables" line 13 at SQL statement
NOTICE:  truncate cascades to table "tmvt"
CONTEXT:  SQL statement "TRUNCATE towner CASCADE"
PL/pgSQL function "ftruncatetables" line 13 at SQL statement
NOTICE:  truncate cascades to table "tmvtremoved"
CONTEXT:  SQL statement "TRUNCATE towner CASCADE"
PL/pgSQL function "ftruncatetables" line 13 at SQL statement
INFO:  The command: VACUUM FULL ANALYZE is recommended
INFO:  All market tables have been truncated
 ftruncatetables 
-----------------
 
(1 row)

-- own,qual_prov,qtt_prov,qtt_requ,qual_requ
select finsertorder('u','b',1000,1000,'a');
INFO:  owner u created
CONTEXT:  PL/pgSQL function "finsertorder" line 35 at assignment
 finsertorder 
--------------
(0 rows)

select finsertorder('v','c',1000,1000,'b');
INFO:  owner v created
CONTEXT:  PL/pgSQL function "finsertorder" line 35 at assignment
 finsertorder 
--------------
(0 rows)

select fgetquote('w','a','c');
   fgetquote   
---------------
 (3,1000,1000)
(1 row)

select finsertorder('w','a',1000,1000,'c');
INFO:  owner w created
CONTEXT:  PL/pgSQL function "finsertorder" line 35 at assignment
 finsertorder 
--------------
 (1-3,3,1)
(1 row)

select id,nb,oruuid,grp,provider,quality,qtt,receiver from vmvt;
 id | nb | oruuid | grp | provider | quality | qtt  | receiver 
----+----+--------+-----+----------+---------+------+----------
  2 |  3 | 1-1    |   1 | u        | b       | 1000 | v
  3 |  3 | 1-2    |   1 | v        | c       | 1000 | w
  1 |  3 | 1-3    |   1 | w        | a       | 1000 | u
(3 rows)

select fremoveagreement(1);
 fremoveagreement 
------------------
                3
(1 row)

select id,qtt from tquality;
 id | qtt 
----+-----
  1 |   0
  2 |   0
  3 |   0
(3 rows)

select finsertorder('u','b',2000,1000,'a');
 finsertorder 
--------------
(0 rows)

select finsertorder('v','c',2000,1000,'b');
 finsertorder 
--------------
(0 rows)

select fgetquote('w','a','c');
  fgetquote   
--------------
 (3,500,2000)
(1 row)

select finsertorder('w','a',500,2000,'c');
 finsertorder 
--------------
 (1-6,3,4)
(1 row)

select id,nb,oruuid,grp,provider,quality,qtt,receiver from vmvt;
 id | nb | oruuid | grp | provider | quality | qtt  | receiver 
----+----+--------+-----+----------+---------+------+----------
  5 |  3 | 1-4    |   4 | u        | b       | 1000 | v
  6 |  3 | 1-5    |   4 | v        | c       | 2000 | w
  4 |  3 | 1-6    |   4 | w        | a       |  500 | u
(3 rows)

select fremoveagreement(4);
 fremoveagreement 
------------------
                3
(1 row)

select fgetquote('w','a','b');
  fgetquote   
--------------
 (2,500,1000)
(1 row)

select finsertorder('w','a',500,1000,'b');
 finsertorder 
--------------
 (1-7,2,7)
(1 row)

select fremoveagreement(7);
 fremoveagreement 
------------------
                2
(1 row)

select id,qtt from tquality;
 id | qtt 
----+-----
  3 |   0
  2 |   0
  1 |   0
(3 rows)

select * from fgetstats(true);
            _name             | cnt 
------------------------------+-----
 number of qualities          |   3
 number of owners             |   3
 number of orders             |   7
 number of movements          |   8
 number of orders removed     |   7
 number of movements removed  |   8
 total number of agreements   |   3
 errors on quantities in mvts |   0
 errors on agreements in mvts |   0
 MAXCYCLE                     |   8
 VERSION                      |  31
 INSERT_OWN_UNKNOWN           |   1
 CHECK_QUALITY_OWNERSHIP      |   0
 MAXORDERFETCH                | 100
 MARKET_OPENED                |   1
 MARKET_SESSION               |   1
 agreements with 2 partners   |   1
 agreements with 3 partners   |   2
(18 rows)

