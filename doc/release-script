#!/bin/bash
# $ cd openBarter
# $ doc/release-script 0.3.1 0.3.2 > ~/.bash/do-release_0.3.2
# $ chmod 777 ~/.bash/do-release_0.3.2
# $ do-release_0.3.2
# connect to https://manager.pgxn.org/upload 
# upload the file ../openbarter-0.3.2.tar.gz
last="$1"
new="$2"
echo "sed 's,MODULE_VERSION,$new,g' META.json.in > META.json"
echo "git commit -a -m 'preparation for v$new' "
echo "git tag -s v$new -m 'release v$new'"
echo "git archive --format=tar --prefix=openbarter-$new/ v$new | gzip -9 > ../openbarter-$new.tar.gz"
echo "# git archive --format zip --prefix=openbarter-$new/ v$new --output ../openbarter-$new.zip"
echo "cp doc/doc-ob.pdf ../openbarter-doc-$new.pdf"
echo "git log --no-merges v$new ^v$last > ../ChangeLog-$new"
echo "git shortlog --no-merges v$new ^v$last > ../ShortLog-$new"
echo "git diff --stat --summary -M v$last v$new > ../diffstat-$new"
echo "git push --tags"
